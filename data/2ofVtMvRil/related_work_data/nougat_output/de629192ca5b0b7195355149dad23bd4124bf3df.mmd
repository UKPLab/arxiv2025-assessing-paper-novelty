# Irregular distribution of grid cell firing fields in rats exploring a 3D volumetric space

Roddy M. Grieves, Selim Jedidi-Ayoub, Karyna Mishchanchuk, Anyi Liu, Sophie Renaudineau, Eleonore Duvelle, Kate J. Jeffery

# Abstract

We investigated how entorhinal grid cells encode volumetric space. On a horizontal surface, grid cells usually produce multiple, spatially focal, approximately circular firing fields that are evenly sized and spaced to form a regular, close-packed, hexagonal array. This spatial regularity has been suggested to underlie navigational computations. In three dimensions, theoretically the equivalent firing pattern would be a regular, hexagonal close packing of evenly sized spherical fields. In the present study, we report that, in rats foraging in a cubic lattice, grid cells maintained normal temporal firing characteristics and produced spatially stable firing fields. However, although most grid fields were ellipsoid, they were sparser, larger, more variably sized and irregularly arranged, even when only fields abutting the lower surface (equivalent to the floor) were considered. Thus, grid self-organization is shaped by the environment's structure and/or movement affordances, and grids may not need to be regular to support spatial computations.

## Introduction

Anorhinal grid cells tile a horizontal environment's surface with a hexagonal-close-packed (HCP) array of approximately circular firing fields, the regular spacing of which is widely thought to provide a distance metric supporting the brain's spatial cognitive map'. An unresolved but central question is whether this map can be three-dimensional (3D), as befits the behavioral ecology of most vertebrates. Hippocampal place cells, the core of the cognitive map in mammals' and probably birds' (but see ref. ), form spatially defined firing fields in a volumetric environment in both bats1 and rats', suggesting a capacity for the vertebrate brain to fully map volumetric space. We investigated whether this map could be founded on a regular 3D entorhinal grid.

Footnote 1: Department of Experimental Psychology, Institute of Behavioural Neuroscience, University College London, London, UK, ‘Department of Psychological and Brain Sciences, Dartmouth College, Hanover, NH, USA, ‘Eke-mail: roddy.m.grieves@dartmouth.edu; k.jeffery@ucl.ac.uk

Theoretical considerations suggest that in a volumetric space, the corresponding (and theoretically optimal) grid structure for 3D spatial mapping would be an HCP or face-centered-cubic (FCC) lattice of firing fields2-13 (Fig. 1a). However, previous studies on vertical surfaces found that grid fields formed vertical stripes2 or expanded blobs2-13 depending on the locomotor affordances (movement constraints) of the surface. In the present study, using wireless telemetry in rats exploring a cubic lattice maze (Fig. 1b-e), we investigated whether grid fields are indeed close packed (that is, optimally organized), randomly dispersed or somewhere in between (irregular with local order). We show that grid cells do stably express focal, 3D fields, but these are larger, more variably sized/shaped and more widely spaced than on a horizontal surface, and are distributed in a random pattern throughout the volume. We explore the implications of this for spatial computations.

## Results

We recorded medial entorhinal cortex (mEC) grid cells in seven rats freely foraging within a 3D climbing lattice maze3-18 (approximately 1 m3; Fig. 1b,c) and a standard horizontal arena (1.2 m3; Fig. 1e and Extended Data Fig. 1a). These recordings were made in an 'A-B-A' format: rats were recorded first in the horizontal arena ('Arena 1' trial) followed by the 3D lattice maze ('Lattice' trial), with a final session back in the original horizontal arena ('Arena 2' trial; Fig. 1e). As we used 3D tracking in all settings, grid fields were analyzed voluntrically even on the arena.

## Rats fully explored 3D, but anisotropically.

Rats fully explored the environments, but in the lattice they spent more time in the bottom layer (Fig. 1d and Extended Data Fig. 1b-e). As we have found previously19, they mainly moved parallel to the maze boundaries and prioritized horizontal movements over vertical ones (Extended Data Fig. 1f; see ref. 20 for in-depth behavior analysis).

## Grid cells exhibited significant and stable spatial activity in the lattice.

We recorded a total of 115 grid cells in layers II-IV of the mEC. For the main analysis, we selected only those cells that had stable grid firing in both arena sessions (_n_ = 47; Fig. 1f,g, Supplementary Fig. 1 for all grid cells, Supplementary Video 1 for rotating plots, Supplementary Fig. 2 for all histology and Supplementary Table 1 for per-rat summary). Analyses for the remaining 68 cells (which were stable in one of the two arena sessions but not in both) are shown in Extended Data Fig. 5; including or omitting these cells did not change the results.

The grid cells selected for the main analysis were stable throughout recording, as shown by similar firing rates throughout sessions, high grid scores (a measure of hexagonality) in the arena sessions and high cross-correlation between the two arena sessions. Spatial correlations were also high between the first and second arena trial maps, and cluster waveforms were stable throughout recording. These effects can be seen in Extended Data Fig. 2.

In both the arena and lattice maze sessions, grid cell firing was spatially stable between session halves (halves versus shuffled: \(P\) < 0.001 in all cases, one-sample Student's _t_-tests; no difference between mazes: \(P\) = 0.20, one-way analysis of variance (ANOVA); Extended Data Fig. 3), albeit with greater stability in the horizontal _X_Y plane of the lattice than the vertical _X_Z or _YZ_ planes (Extended Data Fig. 3b). Furthermore, grid cell activity was also spatially stable when comparing data separated into horizontal and vertical movement epochs (Extended Data Fig. 4), confirming that there was noFig. 11: Grid cells produced firing fields in a 3D climbing lattice.**a**, Hypothetical grid field packings: standard horizontal hexagonal field configuration (G); exploded close-packed lattice, in this case HCP (layers color coded for clarity) (ii); units of the two optimal packings: HCP (left) alternates two layer-arrangements whereas FCC (right) has three (iii); columnar field configuration (iv); and random field configuration (v). **b**, Lattice maze schematic. **c**, Lattice maze photographs. See Extended Data Fig. 1a for arena photographs. **d**, Example coverage in a lattice session. Color denotes normalized (Norm.) dwell time in each region. **e**, Recording protocol. **f**, Example histology. Data for all animals can be seen in Supplementary Fig. 2. **g**. Three representative grid cells in the arena (left) and lattice (right). Left-right arena spike plots (gray shows coverage; red dots show spikes), arena rate maps, arena autocorrelations, volumetric spike plots, volumetric firing rate maps, rate maps as projected on to each of the three coordinate planes and projected autocorrelations. Color bars from top to bottom correspond to volumetric rate maps, autocorrelations and planar rate maps. All grid cells can be seen in Supplementary Fig. 1.

movement-related change in firing (remapping) that might have obscured spatial firing patterns.

Grid cell firing was more spatially clustered than chance even in the lattice (Fig. 2b), indicated by spatial information being consistently higher than spike-train-shuffled data (_P_ < 0.05 in all cases, one-sample Students _t_-tests). However, spatial information was lower in the lattice than the arena and was closer to chance (_F_[2,137] = 20.3, \(P\) < 0.0001, \(\eta^{2}\) = 0.228, Lattice versus Arena 1 or Arena 2: \(P\) < 0.0001; all other: \(P\) > 0.05, one-way ANOVA; Fig. 2b). Although this suggests a disruption of grid cell spatial specificity, there was still a positive correlation between arena and lattice spatial information (Fig. 2c). Similar results were found when using sparsity as an alternative to spatial information content: this was lower than spike-train-shuffled data in all three mazes (Arena 1, Lattice and Arena 2 means: - 12.4, - 5.06 and - 11.7; \(P\) < 0.05 in all cases, one-sample Student's _t_-tests), but was closer to chance than the lattice (_F_[2,137] = 18.6, \(P\) < 0.0001, \(\pi^{2} = 0.213\), Lattice versus Arena 1 or Arena 2: \(P\) < 0.0001; all other \(P\) > 0.05, one-way ANOVA.

### Grid fields were larger, more variable and more widely spaced in the lattice.

Grid fields were observed throughout the lattice maze volume (Fig. 2d and Supplementary Fig. 3b). These tended, on average, to be larger in the lattice, as shown by the grid field radius (Supplementary Fig. 4), which was significantly larger in the lattice compared with the first arena session (_F_[2,131] = 3.7, \(P\) = 0.0284, \(\eta^{2} = 0.053\), Arena 1 versus Lattice \(P\) = 0.0254; all other \(P\) > 0.05, one-way ANOVA; Fig. 2e). There was a significant positive within-cell correlation between field sizes in the arena and lattice (Fig. 2f).

Fields were also more variable in size: we assessed this by computing the coefficient of variation (CV), which is the standard deviation (s.d.) divided by the mean; this was significantly larger in the lattice, as shown by one-way ANOVA (Supplementary Fig. 3a; _F_[2,133] = 10.1, \(P\) = 0.0001, \(\eta^{2} = 0.1318\)). Post hoc tests also confirmed that the lattice differed significantly from each arena trial (_P_ = 0.0004 and 0.0005, respectively). This suggests that fields did not conform to a grid structure.

The number of fields expressed in the arena and lattice was positively correlated (Fig. 2g), suggesting that the clumpiness of grid cell firing in two dimensions was still present to some extent in three dimensions. However, surprisingly, the numbers of fields exhibited in the arena and lattice did not differ (Arena 1: 2.6 +- 0.28; Lattice: 2.9 +- 0.29; Arena 2: 2.6 +- 0.34, mean +-s.e.m. fields; _F_[2,137] = 0.3, \(P\) = 0.72), meaning that there were significantly fewer grid fields per m3 in the lattice than in the arena (_F_[2,137] = 13.8, \(P\) < 0.0001, \(\eta^{2} = 0.167\), Lattice versus Arena 1 or 2 \(P\) < 0.0001; all other \(P\) > 0.05, one-way ANOVA; Fig. 2f). This is consistent with findings from hippocampal place cells in the lattice maze, which also exhibited fewer fields per m3 than expected', and from both place and grid cells on a vertical wall3.

Grid fields also exhibited significantly larger spacing in the lattice (_F_[2,118] = 22.0, \(P\) < 0.0001, \(\eta^{2} = 0.271\), Lattice versus Arena 1 or 2 \(P\) < 0.0001; all other \(P\) > 0.05, one-way ANOVA; Fig. 2j) but spacing in the lattice was not correlated with arena spacing instead, arena grid scale modules were disrupted in the lattice (Fig. 2j).

To summarize, grid cells in the lattice produced stable firing fields, but these were larger, more variably sized and more widely spaced.

### Grid fields did not form a close-packed configuration in the lattice.

We next looked at the spatial pattern of the firing fields in the lattice maze. Previous theoretical and computational work suggests that the optimal packing of grid fields in 3D spaces would be an HCP or FCC configuration8-13. To test this, we first calculated a close-packed quality score (kh_G) that measures the presence of either close-packed structure. This score was significantly lower

Fig. 3: **Grid fields were randomly distributed in the lattice.****a**, Structure scores (_g_FCC, μHCP and _z_COL) for grid cells (markers) and simulations (Simulated fields shown as shaded polygons; HCP, FCC, COL and RND are HPC, FCC, columnar and uniformly random field simulations respectively). **b**, The 2D side projections of **a** showing that grid cells overlapped the most with random configuration scores. **c**, Grid cells categorized based on which field region they fell into (top; 30% of cells are uncategorized) or which configuration score was maximal (bottom). **d**, Interfield distance CV for grid field distances in the arena and lattice compared with their respective shuffled data. Lattice data did not differ from spike-train shuffles (_n_ = 45, 45 and 46 cells). Markers represent cells, open circles denote mean, and error bars denote s.e.m. **c**. Schematic of simulated HCP (top) and FCC (bottom) arrangements. Distance between repetitions of the same layer differ between layer repetitions in HCP (top) and FCC (bottom). **f**, The analysis shown in **e** finds the expected peak correlation patterns in simulated configurations (left; colors same as **a**) but not real grid cells (right; mean and s.e.m.). **g**. Grid cells exhibited low grid scores in all Cartesian coordinate planes of the lattice. Open circles denote average across cells and error bars denote s.e.m. **a.b.f.g**. \(n\) = 46 cells. For multiple comparisons: ***_P_ = < 0.001, *_P_ < 0.01, *_P_ < 0.05; all two-sided tests with Dunn-Sidak correction.

than would be expected if an FCC or HCP arrangement was present and was instead consistent with a non-close-packed arrangement of fields such as columnar or random (COL or RND; Fig. 3a; F[4,442] = 1,612.2, \(P\) < 0.0001, \(e\)3 = 0.936; all groups differ: \(P\) < 0.001 except grid cells and random \(P\) > 0.05). Configuration-specific scores (for FCC, HCP and columns; Supplementary Figs. 5 and 6) were also all close to zero and significantly lower than simulated configurations (Fig. 3a-c and Supplementary Fig. 7). Simulated field configurations most closely matching the real data were uniformly random (Fig. 3c) or shuffled ones (Supplementary Fig. 7b).

We explored this further by computing the CV of the interfield distances: this should be low if interfield distances are uniform. In the arena, interfield distances had a low CV, which is expected in a regular grid pattern. However, CVs in the lattice maze were no different from chance (Fig. 3d). Together, these findings show that grid fields in the lattice were randomly dispersed rather than regularly structured.

In an alternative approach, we reasoned that if a cell expressed an FCC or HCP firing pattern in the lattice maze, its firing rate map should be periodically self-similar (that is, correlate highly with

Fig. 4: **Grid fields in the lattice were vertically elongated and some formed hexagonal columns.****a**, Filled markers represent fields. Top: field elongation in the arena was calculated as the ratio of the largest (‘a’) and second largest (‘b’) axes. In the lattice, ‘b’ was instead calculated as the average of the two smallest axes. Bottom left: fields were significantly more elongated in the lattice. Right: _x_-scored elongation relative to 100 shuffles; text gives the proportion of fields exceeding the shuffle 95th percentile (that is, nonspherical; \(z\) = 196, gray line; \(n\) = 124, 132 and 120 fields for Arena 1, Lattice and Arena 2 trials respectively). **b**, Top: spherical heatmaps of the direction of all grid field temporal axes (see Supplementary Fig. 9 for a schematic). Bottom: mean and 95% confidence interval of fields with a principal axis parallel to the \(X\), \(Y\), \(Z\) axis relative to chance (red area denotes 99th percentiles). Asterisks denote significant deviation; the numbers give effect size (Cohen’s _d_). **c**, Markers represent cells. Left: grid scores for all grid cells in the arena _XY_ plane (_n_ = 47) and each projected plane of the lattice maze (_n_ = 46). Right: proportion of grid cells with a grid score exceeding the 95th percentile of a chance distribution in each lattice plane. **d**, Examples of significant _XY_ grid cells recorded from two rats. Top: volumetric firing rate map. Bottom: autocorrelation of the _XY_ projected firing rate map. See Extended Data Fig. 6 for square grid scores and Extended Data Fig. 7 for further analyses on significant _XY_ grid cells. **a**, open circles denote mean and error bars denote \(s\).**c**, For multiple comparisons: ***_P_ < 0.001, ***_P_ < 0.01, ***_P_ < 0.05; all two-sided tests with Dunn–Sidak correction.

[MISSING_PAGE_FAIL:6]

cues, are needed to fully explore this relationship. Alternatively, it may be that the information that grid cells supply to place cells is independent of the regularity of their fields.

In summary, our findings show that grid cells do generate firing fields that are distributed throughout a volumetric space, forming the potential substrate for a volumetric cognitive map such as the place cell map. However, they also show that the self-organizing process for grid cells is sensitive to environment type, with the result being variation in field size and regularity or irregularity of the grid depending on environment structure and/or movement affordances. These findings invite a reappraisal of the computational contributions that grid cells make to spatial mapping, because they suggest that any metric contribution of grid fields to spatial localization in 3D space (if there is one) must arise from the statistics of their dispersal rather than their precise arrangement.

### Online content

Any methods, additional references, Nature Research reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at [https://doi.org/10.1038/s41593-021-00907-4](https://doi.org/10.1038/s41593-021-00907-4).

Received: 30 March 2021; Accepted: 9 July 2021; Published online: 11 August 2021

## References

* [1] Hattling, T., Flynn, M., Molden, S., Moser, M. B. & Moser, E. I. Microstructure of a spatial map in the entorhinal cortex. Nature **436**, 801-806 (2005).
* [2] Moser, E. I., Kroppel, E. & Moser, H. B. Place cells, grid cells, and the brais spatial representation system. Annu. Rev. Neurosci. **31**, 69-69 (2008).
* [3] Payne, H. I., Lynda, G. & A. Aronov, D. Precise spatial representations in the hippocampus of a food-caching bird. Preprint at _bioRxiv_[https://doi.org/10.1101/2020.11.27.399444](https://doi.org/10.1101/2020.11.27.399444) (2020).
* [4] Ben-Yishay, E. et al. Directional tuning in the hippocampal formation of birds. Curr. Biol. **31**, 2592-2604 (2021).
* [5] Yartsev, M. M. & Ulanovsky, N. Representation of three-dimensional space in the hippocampus of birds. Science **340**, 367-372 (2013).
* [6] Wohlgenhut, M. J., Yu, C. & Moss, C. E. 3D hippocampal place field dynamics in free-flying echolocating bats. Front. Cell. Neurosci. **12**, 270 (2018).
* [7] Grieves, R. M. et al. The place-cell representation of volumetric space in rats. Nat. Commun. **11**, 789 (2020).
* [8] Gauss, C. E. Bsepenshoe des Buchs von L.A. Seeber: Untersuchungen uber die Eigenschaften der positiven tenriaren quadratischen Formen use. Geitragsche Geldart. Anzeign **2**, 188-196 (1831).
* [9] Jeffery, K. J., Jovaleis, A., Vererlidis, M. A. & Hayman, R. M. Navigating in a three-dimensional world. Behav. Brain Sci. **36**, 523-543 (2013).
* [10] Jeffery, K. J., Wilson, J. J., Casali, G. & Hayman, R. M. Neural encoding of large-scale three-dimensional space-properties and constraints. Front Psychol. **6**, 927 (2015).
* [11] Mathis, A., Stemmler, M. B. & Herz, A. V. M. M. Probable nature of higher-dimensional symmetries underlying mammalian grid-cell activity patterns. _eLife_**2015**, e05979 (2015).
* [12] Stella, F. & Tieves, A. The self-organization of grid cells in 3D. _eLife_**2015**, e05913 (2015).
* [13] Horiuchi, T. K. & Moss, C. E. Grid cells in 3-D: reconciling data and models. Hippocampus **25**, 1489-1500 (2015).
* [14] Hayman, R. M., Vererlidis, M. A., Jovaleis, A., Fenton, A. A. & Jeffery, K. J. Anisotropic encoding of three-dimensional space by place cells and grid cells. Nat. Neurosci. **14**, 1182-1188 (2011).
* [15] Casali, G., Bush, D. & Jeffery, K. J. Altered neural odometry in the vertical dimension. Proc. Natl. Acad. Sci. USA **116**, 4631-4636 (2019).
* [16] Grobbey, M.-C. & Schlenk, F. Spatial learning in a three-dimensional maze. Annu. Behav. **43**, 1011-1020 (1992).
* [17] Jeddi-Ayoub, S. et al. Volumetric spatial behaviour in rats reveals the anisotropic organization of navigation. Annu. Cogn. **24**, 133-163 (2021).
* [18] Jovalek, A. et al. Horizontal biases in rat' use of three-dimensional space. Behav. Brain Res. **222**, 279-288 (2011).
* [19] Soman, K., Chakravarthy, V. S. & Yartsev, M. M. A hierarchical anti-Hebbian network model for the formation of spatial cells in three-dimensional space. Nat. Commun. **9**, 4046 (2018).
* [20] Jeffery, K. J., Wilson, J. J., Casali, G. & Hayman, R. M. Neural encoding of large-scale three-dimensional space-properties and constraints. Front. Psychol. **6**, 927 (2015).
* [21] Wang, W. & Wang, W. Place cells and geometry lead to a flexible grid pattern. J. Comput. Neurosci. **2021**, 1-12 (2021).
* [22] Wang, Y., Xu, X., Pan, X. & Wang, R. Grid cell activity and path integration on 2-D manifolds in 3-D space. Nonlinear Dyn. [https://doi.org/10.1007/s11021-06337-02011](https://doi.org/10.1007/s11021-06337-02011).
* [23] Ginosar, G., Finkelstein, A., Las, L. & Ulanovsky, N. Representation of 3D space in the entorhinal cortex of flying bats. Neuroscience Meeting Planner, San Diego, CA, [https://www.adustractions.com/pub/s4/e46/ij/presentation/7353](https://www.adustractions.com/pub/s4/e46/ij/presentation/7353) (2018).
* [24] Page, H. J., Wilson, J. J. & Jeffery, K. J. A dual-axis rotation rule for updating the head direction cell reference frame during movement in three dimensions. J. Neurophysiol. **119**, 192-208 (2018).
* [25] LaChance, P. A., Dumont, I. R., Ozel, P., Marconi, I. I. & Taube, J. S. Commutative properties of head direction cells during locomotion in 3D: are all routes equal J. Neurosci. **40**(15), 3035-3051 (2020).
* [26] Knieira, J. J. & Mrangbottom, B. L. Hippocampal place-cell firing during movement in three-dimensional space. J. Neurophysiol. **85**, 105-116 (2001).
* [27] Klukas, M., Lewis, M. & Fitete, I. Efficient and flexible representation of higher-dimensional cognitive variables with grid cells. PLoS Comput. Biol. **16**, e0107096 (2020).
* [28] Brandon, M. P., Koenig, I., Lottgeb, J. K. & Leitgeb, S. New and distinct hippocampal place codes are generated in a new environment during septal inactivation. Neuron **82**, 789-796 (2014).

**Publisher's note** Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.

**C. O. Open Access** This article is licensed under a Creative Commons Attribution 40 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the articles Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the articles Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit [http://creativecommons.org/licenses/by/d/](http://creativecommons.org/licenses/by/d/).

**O. The Author(s)** 2021

## Methods

This experiment compiled with the national (Animals (Scientific Procedures) Act, 1986, United Kingdom) and international (European Communities Council Directive of November 24, 1986 (86/609/EEC)) legislation governing the maintenance of laboratory animals and their use in scientific experiments. Experimental procedures were approved by the UK Home Office and ethical approval was granted through consultation with veterinary staff at University College London.

Animals. Nine male Lister Hooked rats were used (only seven of these animals contributed grid cells. rats sourced from Charles River Laboratories), weighing approximately 400-450 deg at the start of the experiment. No statistical methods were used to predetermine sample sizes but our sample sizes are similar to those reported in previous publications\({}^{\circ}\)\({}^{\circ}\)\({}^{\circ}\)\({}^{\circ}\). Before surgery all animals were housed for a minimum of 8 weeks in a large (2.15 x 1.55 x 2 m) cage enclosure, lined on the inside which chicken wire. This was to provide the rats with sufficient 3D climbing experience. During this time, they were given unlimited access to a miniature version of the lattice maze (11 cm spacing rather than 16 cm for the recording lattice). The animals were loaded individually in cage after surgery and given access to a hanging humancox or dishmable next box for continued 3D experience.

The animals were maintained under a 12 h lightdark cycle (light starting at 6am) and testing was performed during the light phase of this cycle. Throughout testing, rats were feed restricted such that the maintained approximately 90% (and not less than 85%) of their free-feeding weight. A summary of the sessions and cells recorded from each rat can be seen in Supplementary Table 1.

### Electrodes and surgery.

Axon (MDR-RX) microdevices were used. Drives supported four or eight tetrodes composed of four HML-coated, 17-mm diameter, 90% platinum/10% tridium wires (California Fine Wire), gold-plated (Non-Cyanide Gold Plating Solution, Neurval) to reduce their impedance to 180-300 k\(\Omega\) measured at 1 kHz. Microdevices were implanted using standard stereotaxic procedures under isoflurane anesthesia\({}^{\circ}\). Briefly, six support screws were inserted in the skull, electrodes were implanted after removal of dura, and the drive, shall and screw assembly was secured with an optional first layer of dental cement (Super-Bond C&B Method), followed by several layers of regular acrylic dental cement (Simple Rapid Acrylic, Kernland). Electrodes were implanted at a post-mortem 8-11-slope (e.g., with the electrode tip pointing towards the animal's nose), 1-15 mm below the dura, approximately 4.5 mm medial to the midline and as dose as possible to the transverse sinus. See Supplementary Fig. 2 for histology results and a photo of an implanted drive.

### Apparatus.

All experiments were conducted in the same room (3.2 x 2.1 x 2.2 m)\({}^{\circ}\) under moderately dimmed light conditions. Three of the room walls were covered with black material with large high-contrast cues on two of them (1.5 x 1.2 m\({}^{\circ}\) cardboard sheet and a 1 x 1.7 m\({}^{\circ}\) vinyl plastic sheet). The fourth walls were covered with a white cotton sheet. The floor of the room was covered with black anti-static linoleom flooring. We used two pieces of experimental apparatus: a square open field environment ("wem") and a cubic lattice composed of horizontal and vertical diaphragms bars (lattice").

The arena was a 1.2 x 1.2 m\({}^{\circ}\) square high-walled wooden enclosure, composed of four 1.8 x 0.65 m\({}^{\circ}\) mate blade- painted walls (Extended Data Fig. 1a). The top edges of these walls were covered with large, corrugated tubing to prevent the rats from exploring this area. The bottom edge of this square was highlighted with a strip of 50% gray paint. One 0.45 x 0.65 m\({}^{\circ}\) m\({}^{\circ}\) m\({}^{\circ}\) white wooden cue was affixed to one wall. Rats were recorded freely forging in the arena for randomly dispersed, flavored perfect (CocoProS, Kellogensis).

The cable lattice maze (Fig. 1a) has constructed from a children's toy-set (miniQUADR, Quadropolar). Hollow cubes were created by attaching red plastic tubes (length: 150 mm, diameter: 10 mm) using six- or four-way connectors (each 10-mm wide). These cubes were then assembled into a 6 x 6 x 6 x 6 cubic (0.97 x 0.97 m\({}^{\circ}\)). The maze was raised 0.45 m above the ground, initially on black metal stools but later on a narrow wooden frame. To encourage exploration, malt paste (GimCat Mali-Soft Paste, H. von Gimbomb) was smeared onto the bars of the lattice by the experimenter. This paste was spread evenly throughout the maze, midway along the bars, equally between horizontal and vertical bars and rappeled every 15 min.

### Recording setup and procedure.

Single unit activity was collected using a customized 64-channel recording system (Axon) running Axon dacqUSB software. The rats microdrive was connected to a wireless headstage (custom 64-channel, W-series, Triangle Biosystems Int.). Analog signals were transmitted to a wireless base station via dual receiver antennae situated approximately 1 m above the maze environments. Unfiltered signals were sampled at 50 kHz, amplified 100 times and transmitted at approximately 3.375 GHz (300W at 3 m). They were passed to an Axonapream/amplifier and amplified a further 100 times, and then to a system unit for single unit recording where the signal was bandpass (Butterworth) filtered between 300 and 7.000 Hz. Signals were digitized at 48 kHz and could be further amplified 10-40 times at the experimenter's discretion. For local field potential (LFP) recording, a 4.8-kHz signal was saved as above, which was then bandpass filtered between 6 and 12 Hz (fourth-order Butterworth filter, MATLAB butter and fitilth) for theta analyses described below. The position of the animal was recorded using five infrared sensitive CCTY cameras (Samsung SCB-5000P) tracking four wide-angle infrared light-emitting diodes (Oxram Opto SFH 487P, 880 nm) fixed to the wireless headstage.

After recovery from surgery, rats were screened for single unit activity and the presence of theta oscillations once or twice, 5 d a week. Screening was performed in the open field apparatus, after which rats freely foraged on the lattice maze for the same duration to ensure equal novelty between the masses. Once the presence of grid cells was confirmed, rats were recorded using the experimental procedure (Fig. 1e).

In these sessions, rats were recorded for a minimum of 18 min in the arena and until they had sufficiently explored the environment (mean +- - & - 27.8 +- 3.8 min). They were then allowed to cost and drink in an opaque, lidded box for approximately 10 min. During this time, the arena was dismantled and replaced with the lattice maze. Rats were then placed on the bottom layer of the lattice and left to forage in this environment for a minimum of 45 min and until they had sufficiently explored the environment (mean +- & : 69.0 +- 22.8 min). Rats were returned to the opaque box as before and then recorded in the arena for a further minimum of 16 min and until they had sufficiently explored the environment (mean +- & : 27.4 +- 9.9 mm). During recordings, the experimenter monitored progress from a connected room, which housed the recording equipment and was separated from the experimental room by a black opaque curtain.

At the end of the recording session, the animals were removed from the apparatus and the electrodes were lowered by at least 20 min to maximize the chance of recording from a different population of cells on the following day. Grid cells with similar fields seen on the same tetrodes on consecutive days were discarded: all analyzed grid cells can be seen in Supplementary Fig. 1. Rats were tested until grid cells were no longer observed and was judged that the electrodes had left the desired layer (mean +- & : 47 +- 2.7 sessions).

### Trajectory reconstruction.

The rats position was tracked in real time at a 25-Hz sampling frequency using Dacq[Track software (Axon). Position data were synchronized with neural data using a pulsed optic interface--each camera monitored a 1-Hz TTI. (through the lens)-trained HILT source, controlled by the recording system, which allowed accurate, offline synchronization. The onset of these light pulses was used to continually explain the position data using nearest neighbor interpolation (MATLAB interp1).

The rats 3D position was then reconstructed using the direct linear transform algorithm\({}^{\circ}\) applied to the data from all five cameras, in pairs. Briefly, these cameras were first calibrated to reverse any distortion introduced by their optical elements (MATLAB estimateCameraParameters, undistorImage and undistorPoints). We then imaged the same checkboard pattern with each camera and used its 3D pose to calculate the distance and orientation of each camera relative to it and thus to each other (MATLAB extrinsics and cameraMatrix). Using this information, we constructed a fundamental matrix. If \(x\) represents some points viewed by camera 1 and _x_' represents the same points viewed by camera 2, the fundamental matrix. \(F\), represents the relationship between points \(x\) and _x_'.

This relationship can be used to triangulate any given pair of points imaged by two cameras into 3D space\({}^{\circ}\). For each recording session we reconstructed the animals path using every possible pair of cameras (MATLAB triangulate) and we then combined these reconstructions into one single trajectory. This was achieved by taking the weighted mean of each point, where the weighting was the reliability of the points estimated location. Reliability was assessed using each point's reprojection error: after triangulation, each point was projected back into both camera images and the reprojection error was then calculated as the distance between the original and reprojected position of the point.

In this setup, the rats need be viewed by only two cameras at any one time for a successful reconstruction, allowing for almost continuous tracking even in cluttered, complex environments such as the lattice maze. Our cameras were extremely stable; however, recalibrations were conducted on every 2-4 weeks to ensure continued reconstruction accuracy. For segments of missing tracking data, we simultaneously interpolated and smoothed the existing data using an unsupervised, robust, discretized, _n_-dimensional spline smoothing algorithm (MATLAB smooth(tm)). Example 3D trajectories can be seen in Extended Data Fig. 1b.

### Behavior and spherical heatmaps.

Using smoothed and interpolated 3D reconstructed position data we calculated the instantaneous 3D heading of the animal as the normalized change in position:

\[\tilde{u} = \frac{\tilde{u}}{\left\| \tilde{u} \right\|}\]

where:

\[\tilde{u} = \left( \Delta_{X}\left( t \right), \Delta_{Y}\left( t \right), \Delta_{Z}\left( t \right) \right)\]

and

\[\left\| \tilde{u} \right\| = \sqrt{\Delta_{X}\left( t \right)^{2} + \Delta_{Z}\left( t \right)^{2} + \Delta_{Z}\left( t \right)^{2}}.\]

## MATERIALS

This gives a unit vector representing the animal's heading at time \(t\). For visualization we projected these vectors on to a unit sphere as described below (Grid field orientation).

Grobody and Schenk" and Jovalekic et al.1 previously reported, in lattice mazes similar to the one used here, that rats exhibited a strong bias for horizontal movements. To test this in our lattice maze, we compared the number of times each animal crossed from one lattice element (the smallest cubic subcomponent of the maze) to another. This was computed in each of the \(X\), \(Y\) and \(Z\) axes because the lattice edges and bars were aligned with these. We considered \(x\) crossing to have occurred when the head of the rat moved from one unit to another. A detailed analysis of the behavioral data can be found elsewhere1 and so only brief results related to grid cell activity are reported in the present study.

Footnote 1: The \(X\) axis is the axis of the cell, and the \(X\) axis is the axis of the cell.

### Spike sorting.

Single unit activity was analyzed offline using a combination of MATLAB functions and spike- sorting software. First, the dimensionality of the waveform information was reduced to the first three principal components and amplitude. Based on these parameters, an automated spike-sorting algorithm (JKlustakvich \(x\), 3.0 (ref.)) was used to distinguish and isolate separate clusters. The clusters were then further checked and refined manually using a cluster cutting GUI (TINT v.4.4.12, Axona). As well as the previously mentioned features, manual cluster cutting also made use of spike auto- and cross-corredograms.

### Firing rate maps.

To generate 3D volumetric firing rate maps we used an adaptive binning method described previously2,3,4. Briefly, for every bin a circle centered on the point was gradually expanded until the following criterion was met:

\[r > a/n/\sqrt{s}\]

where \(a\) is a constant, \(r\) is the radius of the circle in pixels, \(n\) is the number of occupancy samples falling within the circle and \(s\) is the total number of spikes falling within the circle. One this criterion has been met, the firing rate assigned to the point was equal to _s_/_n_. For our maps, \(a\) was set to the value 1,600 and we calculated the firing rate across a 2.5-cm2 grid. Periods where the animals were moving <5 cm3 = "s" were not included in any firing rate maps to avoid potential contamination by a low-speed phenomenon (sharp-wave/ripple activity, licking behavior, and so on).

When calculating the stability of spatial activity between volumetric maps to avoid inflated comparisons based on many small works, we instead made maps using a standard histogram procedure (MATLAB histcn, B. Luong). For this, data were binned using a much larger 10-cm2 grid and smoothed using a Gaussian kernel with a std. of 2.5 bins (MATLAB magsunifs1). For 2D maps, such as the Cartesian planar projections, we also generated firing rate maps using a standard histogram procedure (MATLAB histcounts2). For this, data were binned using a 2.5-cm2 grid and smoothed using a Gaussian kernel with an s.d. of 1bin (MATLAB imgunifs1).

### Recording stability between arenas.

To verify that cells were stably recorded during our maze sessions we used a similar approach to one described previously2. First we computed Pearson's pairwise correlation (MATLAB corr) between the first and second area rate maps recorded before and after each lattice maze session. For this we used the 2D _XY_-projected rate maps described above (Firing rate maps). For comparison we correlated first and second area sessions from random grid cells while maintaining their temporal order (that is, first area versus second area from a random grid cell). This shuffle was repeated 5,000 times. The results of this analysis can be seen in Extended Data Fig. 2. See also Waveform stability for an approach independent of spatial activity.

Footnote 2: The \(X\) axis is the axis of the cell, and the \(X\) axis of the cell, and the \(X\) axis of the cell, are the \(X\) axis of the cell.

### Waveform stability.

As a test for cluster recording stability that is not reliant on spatial activity map, we computed average waveforms for each textbook channel (four channels total). We then calculated the Euclidean distance between these waveforms on each textbook channel (50 samples, sampled at 48kHz, MATLAB pklags) between seismic pairs (Arena 1 versus Latrice, Latrice versus Arena 2 and Arena 1 versus Arena 2) and averaged across all four channels. In the resulting values, small distances indicate unchanging waveform shape and stable recording across all four channels.

On their own these values can highlight whether one recording session was consistently unstable relative to the others, but to assess the general stability of all sessions we generated chance distributions for comparison. For these we repeated the above procedure but compared pyramidal cells (neurons with a peak-to-rough width of waveform >250 ms) that were co-recorded on the same tetrodes. The same tetrodes were used for comparable electrode and recording system impedance. Only putative pyramidal cells were used, so that comparisons would be between cells with similar waveform characteristics (most of the recorded grid cells were also assumed to be pyramidal). For example, the waveforms for one pyramidal cell recorded in arena 1 could be compared with the waveforms of another pyramidal cell co-recorded on the same tetrodes in the lattice. These chance distributions reflect the change in Euclidean distance that could be expected if cells randomly shifted position relative to the recording tetrodes while remaining detectable.

### Spatial stability within sessions.

To test the within-session stability of spatial representations, we divided maze sessions into two halves of equal length (first 50% and second 50%) and computed Pearson's pairwise correlation (MATLAB corr) between the firing rate maps for these halves. The two dimensions were generated from data projected on to the Cartesian coordinate planes and we also compared volumetric maps generated as multivariate histograms with 10 cm2-cm2 vortex smoothed using a Gaussian with a 2.5-bin s.d. (MATLAB imgunifs1). Large bins and smoothing were used here to reduce the huge number of spatial bins compared between maps (from around the >3 10 voxels found in adaptively binned rate maps to around <2 10 voxels). Examples of these maps can be seen in Extended Data Fig. 3a. In both cases we compared the observed correlation values with shuffled distributions generated by comparing session halves from random grid cells (that is, first 50% versus second 50% from a random grid cell). This shuffle was repeated 5,000 times for each map type. The results of this analysis can be seen in Extended Data Fig. 3.

### Stability between movement epochs.

To test the stability of spatial representations when rats were moving vertically versus horizontally, we divided maze sessions based on the animal's movement direction (defined in Behavior and spherical heatmap). This consisted of filtering trajectory and spike data to include only vertical movements (defined as movements at a pitch >30 or <-30') or only horizontal movements (defined as movements at a pitch <30' and >-30'). We used a pitch angle of 30deg to delineate movements because this divides the face of a sphere into two halves with equal surface area (a 'bcf' around the equator for one half and two spherical caps for the other). An example filtered trajectory can be seen in Extended Data Fig. 4a. We then repeated the analysis described in Spatial stability within sessions. The results of this analysis can be seen in Extended Data Fig. 4.

### Spatial information and sparsity shuffles.

To determine whether the firing of grid cells was less homogeneous (that is, more 'clumped') than chance, we generated firing rate maps using a standard histogram procedure (MATLAB histcn, R. Luong) with 2cm voxels and smoothed using a Gaussian kernel with an s.d. of 2 voxels (MATLAB imgunifs1). We then calculated spatial information content (bits*s') as:

\[\text{Spatial information} = \sum\limits_{i = 1}^{N}{p_{i}\frac{\lambda}{2}\log\frac{\lambda}{2}}{\sigma_{\text{diff}}}.\]

Next, for each grid cell we shuffled its spike train 100 times by random increments of 0.02s (minimum 20s), and for each shuffle we re-computed a firing rate map and spatial information as above. Last, we expressed the observed spatial information values in s.d.s from the shuffle:

\[\text{Standardized value} = \frac{(\text{Observed value} - \mu_{\text{diff}})}{\sigma_{\text{diff}}}.\]

This essentially _z_-scores the observed values relative to the shuffles. Scores >1.96 exceed the shuffle 95th percentile and thus deviate significantly from the shuffle at the 0.05 level. Similar results were obtained using sparsity (data not shown).

### Directional analyses and shuffles.

As we did not have access to 3D head direction information, we estimated instantaneous projected azimuthal head direction as:

\[\theta\left( t \right) = \tan^{- 1}\left[ \Delta\text{s}^{\prime}/\Delta\text{s}^{\prime} \right\rbrack\]

where \(\Delta\text{s}^{\prime}\) and \(\Delta\text{s}^{\prime}\) represent the change in X or Y position, respectively2, for which we used the smoothed and interpolated position tracking (Trajectory reconstruction) ignoring movements in the Z axis. To generate head direction tuning curves, we binned position and spike directions into 6bins, smoothed the resulting histograms with a Gaussian kernel (MATLAB imgunifs1, \(s\) = bins, circular padding) and then generated a tuning curve by dividing the spike histogram by the time spent in each bin. From these we calculated, as a measure of directionality, the Rayleigh vector length (MATLAB cirr.), circular statistics toolbox3 and preferred firing direction as the bin containing the maximum firing rate.

Next, for each cell we shuffled its spike train 100 times by random increments of 0.02s (minimum 20 s) and for each shuffle recomputed a directional rate map and statistics as above. A cell was categorized as directionality modulated if it exhibited a Rayleigh vector greater than the 95th percentile of the shuffled values in both arena sessions and fired at a rate >0.1 Hz in both.

Last, to determine whether directionally modulated cells maintained their allocentric firing directions across mazes (all recordings were made in the same location in the same room), we correlated the tuning curves for all cells as a population in the arena to their tuning curves in the lattice. For comparison we circularly shifted each cells lattice tuning curve independently by a random number of bins (between 1 and 60) and recomputed the correlation. We repeated this 1,000 times and, if the original correlation exceeded the 95th percentile of the

[MISSING_PAGE_EMPTY:112]

[MISSING_PAGE_FAIL:11]

## ARTICLES

For the columnar score (\(\chi_{\text{COL}}\)), we calculated \(\alpha\) as the median hexagonal grid score found at all pitch angles within 60\(\sigma\) of the best plane and \(\beta\) as the median of all remaining grid scores (Supplementary Fig. 6, right). From these:

\[\chi_{\text{COL}} = \alpha - \beta.\]

### Simulated field arrangements.

Where \(S\) was the side length of a hexagon, points were separated by 5 along the \(x\) axis of \(\sqrt{3}(\text{0.5})\) along the \(y\) axis, with every second row points along the \(y\) axis offset by 5/2 in \(x\); this gives points tilting horizontal space in a hexagonal arrangement. For our simulations, 5 was a value randomly drawn for each cell from the uniform distribution between 200 and 600 mm. For close-packed arrangements these horizontal points were then stacked along the \(z\) axis separated by \(\left( \sqrt{6}/\text{3}\right)\). For HCP, every second layer along the \(z\) axis (second onwards) was offset in \(y\) by \(\left( \sqrt{3}(\text{1})\text{3}\right)\) and every third layer (second onwards) along the \(z\) axis offset in \(y\) by \(\left( \sqrt{3}(\text{1})\text{3}\right)\). For the columnar configuration, the horizontal hexagonal points were stacked continuously in \(z\). For a random arrangement of fields, we generated a random points (MATLAB rand), where \(n\) was the number of points generated for an HCP arrangement, spread within the cuboid volume occupied by an HCP arrangement.

When the desired arrangement of points was generated, for every pixel of the simulated rate map we calculated the Euclidean distance to the nearest field point (MATLAB hydusti) and weighted these using the Gaussian:

\[g\left( x \right) = e^{\left( - \left( \text{- }\delta\left( z \right) \right)^{2} \right)}\]

where \(x\) is the Euclidean distance and \(e\) is the Gaussian s.d., which was set at 2. To ensure that the planar symmetry analysis was capable of differentiating field arrangements even when they are not along the maze/gravity, the resulting simulated firing rate map was then rotated 30\(\sigma\) around a random 3D axis (MATLAB imrotate3 and rand). Simulated field arrangements without this last rotation step can be seen in Supplementary Fig. 7a.

### Grid field shuffle.

To generate fields in random positions while remaining as close to the real data as possible, we employed a field-shuffling technique described previously3. Briefly, adaptive binned firing rate maps were oversmoothed (Firing rate maps, MATLAB imaassultifals, sigma bins) and firing fields were segmented through a watersheding procedure. For this, field peaks were detected as local maxima (MATLAB imextendedmax with an H-maximal or 0.2) and watersheds were calculated on the distance transform (MATLAB hydusti) of these peaks (MATLAB watershed).

The following analyses were then performed on the unsmoothed adaptive binned firing rate map: \(n\) similarly random points were identified in an empty copy of the firing rate map where \(n\) was the total number of fields identified in the watershed procedure. For each segmented field (numbered 1 to \(n\)), the bin with the peak firing rate was copied to one of these random positions. Next, firing rate values were directly moved from the original rate map (O) to the new empty copy (E) after this procedure: for each field in turn (1 to \(n\)) the bin closest to the peak was moved from 0 to 16 while maintaining its position relative to the peak as closely as possible (the "ideal" position). Values were not moved to the locations of unvisited bins in O nor could they overwrite values already moved to E, so where the ideal position was not available values were instead moved to the position nearest to it in any-block distance. This procedure was repeated for every field in turn and in the field order 1 to \(n\) is iteratively, until every bin had been moved from O to a position in E.

Intuitively, this method randomly shuffles the positions of fields within a firing rate map but also preserves, as much as possible, the internal structure of each field. Furthermore, because every firing rate value is moved and both maps share the same number of elements, both maps have the same distribution of firing rate values, the same peak firing rate and the same number of unvisited bins. Unvisited bins also retain their spatial positions, which maintains the shape and configuration of any uneven sampling in the original firing rate map. Due to the computational time cost associated with this shuffling method when using 3D maps and the already large time cost of the planar symmetry analysis, this shuffle was performed only twice per cell. Example field-shuffled firing rate maps can be seen in Supplementary Fig. 8c.

### LFP analyses.

Before analysis, all LFP data had their direct current offsets removed, slowly changing components and running line noise using the Chronux toolbox1-doctoral function, which subtracts the linear regression line fit within a 1-s moving window. They were then resampled at 250 Hz using a polyphase anti-aliasing filter (MATLAB function resample, chip interpolation).

Footnote 1: The Matlab script is available at [http://www.lfp.fr/~lFP/](http://www.lfp.fr/~lFP/)

To obtain a theta phase angle for each spike, LFP was first bandpass filtered in the 6- to 12-Hz range (fourth-order Butterworth, MATLAB buffer and fifth) before a Hilbert transform was applied to obtain the instantaneous phase angle (MATLAB hilbert). Instantaneous frequency was calculated as the derivative of this analytic signal (MATLAB infutter) and instantaneous amplitude was calculated as its magnitude.

To assess the relationship between running speed and the theta oscillation, we compared the instantaneous theta power/amplitude at every position data point (every 20 ms) with the animals' instantaneous running speed. Instantaneous speed was estimated as the total distance traveled in every 40-ms window. To quantify the relationship between speed and power we fitted a linear regression model using a least squares approach (MATLAB pokfit, 1r) and extracted the slope, \(\gamma\)-intercept and sum of squared error. We also performed the same procedures to test the relationship between running speed and instantaneous frequency.

To calculate general theta characteristics, we computed average power spectral densities for each recording session by first zero-padding LFP data to the next highest power of 2. A batch spectral estimator was then applied to obtain the power spectral density (MATLAB pbeckth, Hamming window, 8 segments, 50% overlap). This was computed for 500 logarithmically spaced points between 0 and 250 Hz. Theta power was estimated as the maximum power found in the theta band (6-12 Hz) and theta frequency was defined as the frequency associated with this maximum power.

### Running speed analyses.

Instantaneous running speed was estimated as the total distance traveled in every 40-ms window. For each cell, instantaneous firing rate was estimated as the smoothed spike histogram (20-ms bins, 1-bin for 260-ms Gaussian smoothing window using MATLAB function fspecial). To quantify the relationship between speed and firing rate, we used an analysis similar to that described previously3. We binned the animal's running speeds in 2cm-s increments, and calculated the mean firing rate for each running speed bin and the total time spent moving that speed. We then fitted a linear regression model to the average firing rate/speed data using a least squares approach (MATLAB function polyfit, 1r) and extracted the slope, \(\gamma\)-intercept and sum of squared error.

### Spike phase and autocorrelation analyses.

To quantify the intrinsic theta modulation of every place cell we used an analysis described previously3. For each cell we calculated the \(\pm\)500 ms spike autocorrelation in 10-ms bins, normalized this to the maximum value found between 100 and 150 ms and removed values \(>\)1. Then we fit the following function to the remaining data:

Footnote 3: The Matlab script is available at [http://www.lfp.fr/~lFP/](http://www.lfp.fr/~lFP/)

\[\gamma\left( t \right) = \left( \alpha \times \left( \sin\left( 2\text{a}\text{a}\text{a}\text{t} + \frac{\pi}{2} \right) + 1 \right) + b \right)\times\text{exp}\left( - \frac{\left| t \right|}{\tau_{1}} \right) + c \times \text{exp}\left( - \frac{r^{2}}{\tau_{2}^{2}} \right)\]

where \(a\), \(b\), \(c\), \(\alpha\), \(\tau_{1}\) and \(\tau_{2}\) were fit to the data using a nonlinear least squares method (MATLAB fit) and is the autocorogram time lag. In simple terms this function fits a sine wave of frequency \(\alpha\) to the data, and the exponential term allows for this to decrease exponentially as the time lag increases (reflecting the exponential decay inherent in all spike autocorrelations). The last Gaussian term helps to center the fit on the autocorogram peak, which we found to be unnecessary in most cases. A measure of theta modulation strength was defined as \(a/b\), which intuitively corresponds to the ratio of the sine fit relative to the baseline in the autocorogram. The parameter \(\alpha\) was extracted as the intrinsic theta modulation of the cell. We restricted possible values for \(\alpha\) to [6,12], \(a\) and \(b\) were restricted to non-negative values [0 1rf], \(\gamma\) was restricted to [0,0.8], \(\tau\), was unrestricted and \(\tau_{1}\) was restricted to [0,0.05]. This fitting procedure was carried out only on cells that fired at least 500 spikes.

For each cell, the instantaneous theta phase of every spike was calculated by linear interpolation of the instantaneous theta phase signal described previously. These phase angles were binned between \(-\pi\) and \(\pi\) in 0.1-rad bins. The cells preferred theta phase was defined as the circular mean of these angles and the strength of this modulation was defined as the mean resultant vector length of these angles (MATLAB eirc_mean and circ_r_respectively, circular statistics toolbox2).

### Histology.

At the end of the experiment animals were anesthetized, given an overdose of pentobarbital inverterplonally (Eubthat, Meral Animal Health Ltd) and perfused with 0.9% saline solution followed by a 4% formalin solution. The brain was extracted and stored in 4% formalin for at least 7 d before any histological analyses. The brains were sliced spatially in 30-mm sections on a freezing microframe at \(-20^{\circ}\). These sections were stained with a 0.1% Cresyl violet solution and the slice best representing the electrode track was then imaged. Histology results for every animal can be seen in Supplementary Fig. 2.

### Statistics and figures.

Unless otherwise stated, we used two-tailed parametric tests (for example, MATLAB an ideal and test) and post hoc tests compared population means (MATLAB multicompare, Dunn-Sidak correction). In all figures, " indicates significant at the 0.05 level, " at the 0.01 level and "** at the 0.001 level. For all dot plots, black lines denote the s.d. empty circular markers denote the sample mean and filled markers represent individual data points. Data distributions were assumed to be normal but this was not formally tested. Data collection and analysis were not performed blind to the conditions of the experiments. No animals or data points were excluded from the experiment but putative cell clusters were manually curated to remove noise artifacts.

For the permutation tests described in Extended Data Fig. 7a we computed the mean difference between groups, we then pooled and shuffled samples, divided them into groups matching the original group sizes and recomputed the mean difference. We repeated this 1,000 times and estimated the probability ofthe outcome by \(z\)-scoring the original mean difference to the shuffled values and calculating a \(P\) value as the position of the absolute (one-sided test) \(z\)-value in the cumulative distribution function of a normal distribution with mean 0 and s.d. 1.

**Reporting Summary.** Further information on research design is available in the Nature Research Reporting Summary linked to this article.

## Data availability

A summary dataset is available for download\({}^{\pm}\). The full raw dataset is available from the authors on request. Source data are provided with this paper.

## Code availability

MATLAB code is available for download which, together with the summary dataset, can be used to regenerate all of the figures and analyses reported in the present study\({}^{\pm}\). Code to analyze raw data is available from the authors on request.

## References

* [1] Grieves, R. M., Jenkins, B. W., Harland, B., Wood, E. R. & Dudchenko, P. A. Place field repetition and spatial learning in a multicompartment environment. Hippocampus **26**, 118-134 (2016).
* [2] Hartley, R. & Zisserman, A. _Multiple View Geometry in Computer Vision_ (Cambridge Univ. Press, 2004).
* [3] Garcia, D. A fast all-in one method for automated post-processing of PIV data. Exp. Fluids **50**, 1247-1259 (2011).
* [4] Garcia, D. Robust smoothing of grid data in one and higher dimensions with missing values. Comput. Stat. Data Anal. **54**, 1167-1178 (2010).
* [5] Kadir, S. N., Goodman, D. F. M. & Harris, K. D. High-dimensional cluster analysis with the masked EM algorithm. Neural Comput. **26**, 2379-2394 (2014).
* [6] Skaggs, W. E., McNaughton, B. L., Wilson, M. A. & Barnes, C. A Theta phase precision in hippocampal neuronal populations and the compression of temporal sequences. Hippocampus **6**, 149-172 (1996).
* [7] Skaggs, W. E. & McNaughton, B. L. Spatial firing properties of hippocampal CAI populations in an environment containing two visually identical regions. J. Neurosci. **18**, 8455-8466 (1998).
* [8] Diehl, G. W., Hon, O. J., Leutgeb, S. & Leutgeb, J. K. Stability of medial entorhinal cortex representations over time. Hippocampus **29**, 284-302 (2019).
* [9] Berens, P. CircStat: a MATLAB toolbox for circular statistics. J. Stat. Software, [https://doi.org/10.1363/rss/0311012009](https://doi.org/10.1363/rss/0311012009).
* [10] Brandon, M. P. et al. Reduction of theta rhythm dissociates grid cell spatial periodicity from directional tuning. Science **332**, 595-599 (2011).
* [11] Savelli, F., Luck, J. D. & Khairrami, J. Learning of grid cells within and beyond navigation boundaries. _cLife_**6**, 621354 (2017).
* [12] Barry, C. & Burgess, N. To be a grid cell: shuffling procedures for determining Gridness. Preprint at _bioRxiv_[https://doi.org/10.1101/230250](https://doi.org/10.1101/230250) (2017).
* [13] Bokil, H., Andrews, P., Kulkarni, J. E., Mehta, S. & Mitra, P. P. Chronuc: a platform for analyzing neural signals. J. Neurosci. Methods **192**, 146-151 (2010).
* [14] Kroff, E., Carmichael, J. E., Moser, M. B. & Moser, E. I. Speed cells in the medial entorhinal cortex. Nature **523**, 419-424 (2015).
* [15] Royer, S., Sivota, A., Patel, J. & Bussaki, G. Distinct representations and theta dynamics in dorsal and ventral hippocampus. J. Neurosci. **30**, 1777-1787 (2010).
* [16] van der Meer, M. A. & Redish, A. D. Theta phase precession in rat ventral striatum links place and reward information. J. Neurosci. **31**, 2843-2854 (2011).
* [17] Grieves, R. M. et al. Irregular distribution of grid cell fields in 3D volumetric space: summary dataset and analysis package. _Mondely Data_[https://doi.org/10.1763/23/8/b72/rjr.1](https://doi.org/10.1763/23/8/b72/rjr.1). (2021).

## Acknowledgements

We thank J. Donent of Axona Ltd for his contribution to designing and building the experimental equipment. This work was supported by grants from National Science (grant nos. 103864 A to K.J., 208647/2/17/26 to S.-A. and 2132395/21/26 to A.L.). The funder had no role in study design, data collection and analysis, decision to publish or preparation of the manuscript. For the purpose of open access, we have applied a CC IF public copyright license to any author-accepted manuscript version arising from this submission.

## Author contributions

K.J.L. conceptualized the project, acquired the funding and provided supervision, resources and administration. R.M.G., K.J.J. and S.R. designed and planned the experiments. R.M.G. with the apparatus and established the recording methodology. R.M.G., S.J.-A., K.M. and A.L. collected the data. R.M.G. analyzed, curated and visualized the data. R.M.G., E.D. and K.J.I wrote the manuscript.

## Competing interests

The authors declare the following competing interests. K.J. is a non-shareholding director of Axona Ltd. All other authors declare no competing interests.

## Additional information

Extended data Extended data are available for this paper at [https://doi.org/10.1038/s11593-021-00907-4](https://doi.org/10.1038/s11593-021-00907-4).

Supplementary information The online version contains supplementary material available at [https://doi.org/10.1038/s11593-021-00907-4](https://doi.org/10.1038/s11593-021-00907-4).

Correspondence and requests for materials should be addressed to R.M.G. or K.J.J.

Peer review information Nature Neuroscience thanks Mark Brandon and the other, anonymous, reviewer(s) for their contribution to the peer review of this work.

**Reprints and permissions information** is available at www.nature.com/reprints.

**Extended Data Fig. 1 Animals explored the whole lattice maze with a bias for horizontal movements.****(a)** Side and top-down views of the arena. **(b)** Different views of the 3D positions for a representative arena session. **(c)** Different views of the 3D positions for a representative lattice maze session. **(d)** Top)** averaged dwell time histogram for all arena sessions (n=42). Bottom) mean +- SEM proportion of time spent at different positions within the arena averaged across sessions. Rats explored the entire arena homogenously. **(e)** Top)** averaged dwell time histogram for all lattice maze sessions (n=42); bottom) Mean +- SEM proportion of time spent in each layer of the maze, averaged across sessions. Rats explored the entire lattice homogenously in X and Y but with a strong vertical bias for the bottom layer. **(f)** Left)** spherical heatmaps showing the time spent moving at every possible yaw x pitch angle in the arena and lattice (n=42 sessions). Inset schematics give the maze shape and the corresponding axes shown extending through the spheres. Right)** Filled markers represent sessions (n=42), open circles denote mean, error bars denote SEM. As reported previously, rats were biased towards horizontal movements in both mazes and were far more likely to move parallel to the maze axes: the walls of the arena or the sides and bars of the lattice (\(F(2,123)=417.2\), \(p=1.56\times 10^{-45}\), \(r^{2}=0.872\); one-way ANOVA).

**Extended Data Fig. 2 [ Grid cells were more stable than chance throughout recordings.** For panels A, D, E & F: nu47 cells. For panels A & d: filled markers represent cells, open circles denote mean, error bars denote SEM. (**a**) Grid cell firing rates did not differ between the males (_F_(2,138) = 2.0, \(p\) = 135, \(\overline{n}^{2}\) = 0.029, one-way ANOVA). (**b**) Example grid cell ratemaps and autocorrelations for the two arena sessions. In addition to ratemap autocorrelations we also calculated the cross-correlation between arenas 1 and 2. Only cells with a grid score exceeding the 95\({}^{\circ}\) percentile of a shuffle in both arena sessions were analysed. (**c**) Total number of cells with a grid score exceeding the 95\({}^{\circ}\) percentile of a shuffle in each arena session. The purple bar sections represent the cells categorised as grid cells and included in the main analyses, grey bars represent unstable cells that met our grid cell criteria in only one arena session. Main results were also replicated using only these unstable grid cells (Extended Data Fig. S). (**d**) Grid scores of all grid cells calculated for both arenas and the cross-correlation between arena maps. These scores did not differ (_F_(2,138) = 1, \(p\) = 337, \(\overline{n}^{2}\) = 0.016, one-way ANOVA). (**e**) Left example firing of a grid cell in both arenas. Middle) to determine if grid cells were stable between arenas we correlated their arena firing rate maps (blue area; blue triangle denotes median) and compared this distribution to correlations between 5000 shuffled ratemaps (grey area; grey triangle denotes 95\({}^{\circ}\) percentile). Right) cumulative density curves of the same distributions. Shaded areas denote 95\({}^{\circ}\) confidence intervals. The blue vertical line marks the 95\({}^{\circ}\) percentile of the shuffle on the x-axis and the blue horizontal line (very close to the x-axis) marks the y-intercept of the observed correlation distribution with this. Grid cells were more stable than chance (shuffled arena correlations 95\({}^{\circ}\) percentile 0: 23, grid cell median correlation: 0.59, 0 = 0.96, \(p\) = 0.001, two-sample Kolmogorov-Smirnov test). (**f**) The Euclidean distance between waveforms in different session pairs for all grid cells (Methods: _Waveform stability_). Red horizontal lines denote medians; black horizontal lines denote 1\({}^{\circ}\) and 3\({}^{\circ}\) quantiles, error bars denote data range. Distances did not change across recordings (_F_(2,124) = 2.6, \(p\) =.0787; one-way ANOVA) suggesting grid cells were stably recorded throughout the experiment. Although distances were smallest when comparing the lattice to each arena (Group average Lattice vs Arena 1:25.4, Lattice vs Arena 2:25.5, Arena 1 vs Arena 2:38.1) which is consistent with a gradual decrease in stability over time. In each case the distances between recording pairs were also significantly lower than chance which was estimated using pyramidal cell pairs co-recorded on the same tetrodes (_p_ <.0001 in all cases, two-sample t-tests; black distributions).

Figure 4: **Grid cells did not remap according to movement direction.** See Methods: _Stability_ between _movement_ epochs. For panels **c** & **d**. r=47 cells. (**a**) An example lattice trajectory filtered to show only vertical movements. (**b**) Same as **a** but for horizontal movements. (**c**) Left) example grid cell volumetric firing rate maps used for the movement direction analysis; each map represents the same grid cell activity filtered for vertical (left) or horizontal (right) movement epochs. Note that these maps have much larger voxels than ones used or shown elsewhere. Middle) raincloud plots showing the distribution of correlation values found for grid cells in the lattice (blue) and between random grid cells (grey). Red lines denote medians, black lines denote 1a- and 3a quantiles. Right) cumulative distribution functions of the same distributions. Shaded areas denote 95% confidence intervals. Grid cells were more stable than chance (t(4834) = 12.8, \(p\) = 6.49 x 10-3); two-sample t-test). (**d**) Left) example grid cell projected maps used for planar correlations. Middle) raincloud plots as in **a**, showing the correlations found for each projected plane of the lattice for all grid cells. Right) cumulative distribution functions of these data. Shaded areas denote 95% confidence intervals. All projections were more stable than chance (_p_ <.0001 in all cases; two-sample t-tests) and they did not differ (_F_(2,135) = 2.1, \(p\) =.1249, \(p\) = 0.0303; one-way ANOVA).

**Extended Data Fig. 5 | Main results were similar in unstable grid cells.** These plots supplement main figures but focus on unstable grid cells (that is cells that met our grid cell criteria in only one arena session: grey areas in Extended Data Fig. 2c). For panels **a-d.** (right) **& **i** (right) open circles denote mean, error bars denote 5M and text gives the results of one-way ANOVAs. For multiple comparisons: "**_n_ = \(p\) <.001, " = \(p\) <.05, all two-sided tests with Dunn-Sidak correction. (**a**) Supplement to Fig. 2g; Grid field radius was similar in the lattice and arena sessions. =40, 35, 28 & 27 cells. (**b**) Supplement to Fig. 2j; grid spacing was significantly larger in the lattice. n=40, 25, 28 & 20 cells. (**c**) Supplement to Fig. 2j; 2-scored spatial information was higher than chance in all environments but reduced in the lattice. n=40, 36, 28 & 28 cells. (**d**) Z-scored sparsity was also lower than chance in all environments but was higher in the lattice. n=40, 36, 28 & 28 cells. (**e**) Supplement to Fig. 2j; grid cells exhibited significantly fewer fields per m\({}^{2}\) in the lattice maze. m=76, 82, 68 & 74 cells. (**f**) Supplement to Fig. 4a; fields were significantly more elongated in the lattice. n=175, 233, 166 & 188 cells. (**g**) Supplement to Fig. 3a; structure scores (_y_CC, _z_HCP and _z_COL) for grid cells (n=47, black markers), unstable grid cells (n=68, red markers) and simulations (convex hulls shown as shaded polygons). (**h**) Left) Supplement to Fig. 3c; All grid cells (stable & unstable) categorized based on which convex hull they fell into. Right) configuration specific scores for stable (n=47, black markers) and unstable (n=68, red markers) grid cells. (**i**) Left) Supplement to Fig. 3c; unstable grid cells categorized based on which convex hull they fell into. Right) configuration specific scores for unstable grid cells (n=68) only.

## 3 Square grid scores in the lattice

**Extended Data Fig. 6 | Weak evidence of square pattern activity in grid cells and non-grid cells.** For panels **a** & **c**: Filled markers represent cells, open circles denote mean, error bars denote SEM. (**a**) Left) square grid scores for all grid cells (n=46) in each projected plane of the lattice maze. Square grid scores are low in each of the lattice planes and these did not differ (\(F(2,135)=2.5\), \(p=.0872\), \(p^{\prime}=0.036\), one-way ANOVA). Right) proportion of grid cells with a square grid score exceeding the 95th percentile of a chance distribution in each lattice plane. A small number of cells exhibited a significant square firing pattern when projected onto the \(XY\) and \(YZ\) planes. Grey line shows the value that would be expected by chance (5%). (**b**) Three examples of these significant \(XY\) square grid cells. Top row shows the volumetric firing rate map, text gives the rat number, date, tetrode and cluster. Bottom row shows the autocorrelation of the \(XY\) projected firing rate map, text gives the square grid score (SGS) of the autocorrelation. (**c-d**) same as **a-b** but for all non-grid cells (n=550, 551 & 550). Square grid scores were again low and did not differ between projected planes (\(F(2,1648)=1.2\), \(p=.2975\), \(p^{\prime}=0.0015\), one-way ANOVA). No plane exhibited more square grid cells than would be expected by chance (5%, grey line).

**Extended Data Fig. 7 [ Cells with significant XY hexagonality in the lattice maze.** For panels **c & d**: filled markers represent cells, open circles denote mean, error bars denote SEM. Six grid cells (1 from one animal, 5 from another across a total of 3 sessions) showed a significant hexagonal grid score in the XY plane of the lattice maze. (**a**) Both grid spacing (z = −3.3, \(p\) <.001) and field size (z = 4.5, \(p\) <.0001; permutation tests: Methods: Statistics and figures) in the arena were significantly higher in the XY grid cells (n=6) than the remaining grid cells (n=41) suggesting that the hexagonality of large scale grid cells may be better preserved in 3D space. (**b**) The layer of the mEC cells were recorded in was not related to XY hexagonality. Text gives the result of a two-sided Chi-square test of expected proportions which indicates that the layers where significant XY grid cells (red area) were found could be drawn by chance from the underlying distribution of grid cells (black area). (**c**-**d**) Theta modulation (Methods: Spike phase and autocorrelation analyses) and the proportion of layer crossings that were vertical in the lattice maze (Methods: Behaviour and spherical heatmaps) were also not related to XY hexagonality. Text gives the result of permutation tests (Methods: Statistics and figures). n=41& 6 cells.

**Extended Data Fig. 8 1 Directional modulation was preserved in the lattice.** These analyses were conducted on head direction estimated from speed filtered displacement (Methods: Directional analyses and shuffles). **(a) Markers represent cells, open circles denote mean, error bars denote SEM. Rayleigh vector lengths for all 40 directionally modulated cells (that is, any cells with a Rayleigh vector length exceeding the 95\({}^{\circ}\) percentile of 100 spike train shuffles in both arena sessions, may include grid cells). Grey line denotes a commonly used arbitrary cut-off (0.3) and test gives the proportion of cells with a Rayleigh vector length greater than this. Vector lengths were lower in the lattice (\(F(2,117)\) = 71, \(p\) = 0.0013, \(\eta^{2}\) = 0.108, one-way ANOVA). **(b)** Vector lengths were correlated between Arena 1 and the lattice suggesting preserved directional modulation in this maze. LLS: linear least squares line fit. Text gives the result of a Pearson linear correlation and the slope of the LLS. **(c)** Left) normalized Arena 1 tuning curves for all directionally modulated cells sorted by their preferred firing direction (PPD; peak firing). Right) normalized lattice tuning curves sorted by their Arena 1 PFD. The preserved diagonal ordering suggests that cells maintained the same dielectric firing directions in the lattice, the population correlation between arena and lattice tuning curves (\(r\) = 0.85) exceeded the 95\({}^{\circ}\) percentile of 1000 shuffles (\(r\) = 0.33; \(z\) = 83, \(p\) < 0.0001) confirming this. **(d)** Overlaid arena and lattice polar tuning curves for 8 example directional cells. Coloured text gives the Rayleigh vector length for the corresponding tuning curves. **(e)** Same as **c** but for all conjunctive grid \(\times\) direction cells (n = 7). As before, the correlation between arena and lattice tuning curves (\(r\) = 0.91) exceeded the 95\({}^{\circ}\) percentile of 1000 shuffles (\(r\) = 0.55; \(z\) = 3.7, \(p\) = 0.0001) confirming that conjunctive grid cells maintained the same allocentric firing directions in the lattice. **(f)** Example conjunctive grid cells, one per row, ratemap, spatial autocorrelation and overlaid tuning curves as in D.

[MISSING_PAGE_EMPTY:124]

### Field-specific reporting

Please select the one below that is the best fit for your research. If you are not sure, read the appropriate sections before making your selection.

Life sciences

Behavioural & social sciences

Ecological, evolutionary & environmental sciences

for a reference copy of the document with all sections, see nature.com/documents/nr-reporting-summary.fits.pdf

### Life sciences study design

All studies must disclose on these points even when the disclosure is negative.

Sample size of 4-10 animals are typical in hippocampal research (Greives et al. 2020; Flores-Abreu et al. 2014; Porter et al. 2018). We collected data from 9 animals (grid cells in 7 of these) which is a large enough number to ensure the effects we see are not specific to one animal or cohort. Cell yields can vary dramatically in hippocampal recordings, we recorded 115 grid cells of which we selected only the most stable, leaving 47 grid cells. This number is in line with other research using wireless telemetry in animals navigating in 3D (i.e. 55 place cells in Pring bats; Yartsev & Ulanovsky, 2013; 44 grid cells in climbing rats; Hayman et al. 2015; 19 head direction cells in climbing rats; Page et al. 2018). We feel this yield is high even the difficulty of the wireless and 3D nature of the recordings. No a priori power analysis was undertaken.

Data exclusions

No animals or grid cells were excluded. Data clusters that were not classified as grid cells were excluded.

Replication

Replication was not undertaken in this study although our effects are present across animals and sessions. Replication of our effects has to be performed by an independent laboratory and there are not currently laboratories with the required equipment to carry out this replication.

Randomization

We had one treatment group so there was no need for randomization.

Binding

All animals were part of the same treatment group (arena-lattice-arena) and so the only binding possible would be against the maze type. However, binding was not possible during data collection as the difference in mases was immediately apparent. Furthermore, there was no way for the experimenter to influence the outcome of the neural recordings in a predictable manner. The same experimenters who collected the data analyzed it and were thus not able to be blinded during analysis; furthermore, it would also not be possible for the analysis to be performed blinded as the two mases vary in their dimensions and shape making their data often immediately recognizable.

### Reporting for specific materials, systems and methods

We require information from authors about some types of materials, experimental systems and methods used in many studies. Here, indicate whether each material, system or method listed is relevant to your study. If you are not sure if a list item applies to your research, read the appropriate section before selecting a response.

\begin{tabular}{c c c} Materials \& experimental systems & Methods \\ n/a & Involved in the study & n/a & Involved in the study \\  & Antibodies & ChIP-seq \\  & Eukaryotic cell lines & & Flow cytometry \\  & Palaeontology and archaeology & & MRI-based neuroimaging \\  & Animals and other organisms & & Animals and other organisms \\  & Human research participants & & Human research participants \\  & Clinical data & & Clinical data \\  & Dual use research of concern & & \\ \end{tabular}

### Animals and other organisms

Policy information about studies involving animals: ABRIVE guidelines recommended for reporting animal research

Laboratory animals

Lister hooded rats, male, 250-400g in weight, age unknown (estimated to be between 10 and 20 weeks).

Wild animals

The study did not involve wild animals

Field-collected samples

The study did not involve samples taken from the field/wild.

Ethics oversight

Animal care technicians, Named Veterinary Surgeons and Named Animal Care and Welfare Officers provided ethical and care

guidance. This experiment completed with the national (Animals (Scientific Procedures) Act, 1986, United Kingdom) and international

European Communities Council Directive of November 24, 1986 (86/609/EEC) legislation governing the maintenance of laboratory

animals and their use in scientific experiments. Experimental procedures were approved by the UK Home Office and ethical approval

was granted through consultation with veterinary staff at University College London.

Note that full information on the approval of the study protocol must also be provided in the manuscript.